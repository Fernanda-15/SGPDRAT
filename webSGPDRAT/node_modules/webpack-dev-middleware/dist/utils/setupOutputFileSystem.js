"use strict";

<<<<<<< HEAD
const path = require("path");

const memfs = require("memfs");
/** @typedef {import("webpack").MultiCompiler} MultiCompiler */

/** @typedef {import("../index.js").IncomingMessage} IncomingMessage */

/** @typedef {import("../index.js").ServerResponse} ServerResponse */

/**
 * @template {IncomingMessage} Request
 * @template {ServerResponse} Response
 * @param {import("../index.js").Context<Request, Response>} context
 */

=======
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = setupOutputFileSystem;

var _path = _interopRequireDefault(require("path"));

var _memfs = require("memfs");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }
>>>>>>> main

function setupOutputFileSystem(context) {
  let outputFileSystem;

  if (context.options.outputFileSystem) {
<<<<<<< HEAD
=======
    // eslint-disable-next-line no-shadow
>>>>>>> main
    const {
      outputFileSystem: outputFileSystemFromOptions
    } = context.options; // Todo remove when we drop webpack@4 support

    if (typeof outputFileSystemFromOptions.join !== "function") {
      throw new Error("Invalid options: options.outputFileSystem.join() method is expected");
    } // Todo remove when we drop webpack@4 support
<<<<<<< HEAD
    // @ts-ignore
=======
>>>>>>> main


    if (typeof outputFileSystemFromOptions.mkdirp !== "function") {
      throw new Error("Invalid options: options.outputFileSystem.mkdirp() method is expected");
    }

    outputFileSystem = outputFileSystemFromOptions;
  } else {
<<<<<<< HEAD
    outputFileSystem = memfs.createFsFromVolume(new memfs.Volume()); // TODO: remove when we drop webpack@4 support
    // @ts-ignore

    outputFileSystem.join = path.join.bind(path);
  }

  const compilers =
  /** @type {MultiCompiler} */
  context.compiler.compilers || [context.compiler];

  for (const compiler of compilers) {
    compiler.outputFileSystem = outputFileSystem;
  } // @ts-ignore
  // eslint-disable-next-line no-param-reassign


  context.outputFileSystem = outputFileSystem;
}

module.exports = setupOutputFileSystem;
=======
    outputFileSystem = (0, _memfs.createFsFromVolume)(new _memfs.Volume()); // TODO: remove when we drop webpack@4 support

    outputFileSystem.join = _path.default.join.bind(_path.default);
  }

  const compilers = context.compiler.compilers || [context.compiler];

  for (const compiler of compilers) {
    // eslint-disable-next-line no-param-reassign
    compiler.outputFileSystem = outputFileSystem;
  } // eslint-disable-next-line no-param-reassign


  context.outputFileSystem = outputFileSystem;
}
>>>>>>> main
